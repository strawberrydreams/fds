<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <th:block th:replace="~{index :: common_head('마이페이지 | 안심거래 뱅킹')}"></th:block>
    <style>
        :root {
            --primary-color: #001a72;
            --accent-color: #ff4757;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --border-color: #e1e4e8;
            --safe-color: #2ecc71;
            --deposit-color: #28a745;
        }
        body { font-family: 'Segoe UI', 'Pretendard', sans-serif; margin: 0; background-color: var(--bg-color); color: #333; }

        .navbar { display: flex !important; align-items: center !important; height: 70px !important; }
        .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }

        .dashboard-grid { display: grid; grid-template-columns: minmax(0, 1fr) 320px; gap: 25px; align-items: start; }

        .card { background: var(--card-bg); border-radius: 16px; padding: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-bottom: 20px; overflow: hidden; }
        .card-title { font-size: 18px; font-weight: bold; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }

        .account-card { background: linear-gradient(135deg, #001a72 0%, #0033cc 100%); color: white; border: none; }
        .balance-amount { font-size: 32px; font-weight: bold; margin: 10px 0; }

        .card-wallet { display: flex; gap: 20px; overflow-x: auto; padding: 10px 5px 20px 5px; scroll-behavior: smooth; }
        .card-wallet::-webkit-scrollbar { height: 6px; }
        .card-wallet::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .card-wallet::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }

        .card-visual { flex: 0 0 280px; height: 160px; border-radius: 12px; padding: 20px; color: white; font-family: 'Courier New', monospace; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .card-visual.CHECK { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .card-visual.CREDIT { background: linear-gradient(135deg, #434343 0%, #000000 100%); }

        .card-num { font-size: 16px; letter-spacing: 2px; margin-top: 45px; }
        .card-name { margin-top: 25px; font-size: 12px; font-family: sans-serif; text-transform: uppercase; }

        /* 거래 내역 스타일 */
        .transaction-list { list-style: none; padding: 0; margin: 0; }
        .transaction-item { display: flex; justify-content: space-between; align-items: center; padding: 18px 0; border-bottom: 1px solid #f0f0f0; }
        .transaction-item:last-child { border-bottom: none; }
        .tx-info .desc { font-weight: bold; font-size: 16px; color: #1a1a1a; display: block; margin-bottom: 4px; }
        .tx-info .time { font-size: 13px; color: #999; }
        .tx-amount { font-weight: bold; font-size: 16px; }

        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        .btn-action { background: rgba(255,255,255,0.2); color: white; padding: 12px; border-radius: 8px; text-decoration: none; flex: 1; text-align: center; font-size: 14px; font-weight: bold; }
        .menu-item-side { background: #f8f9fa; padding: 12px; border-radius: 10px; text-align: center; text-decoration: none; color: #555; font-size: 13px; border: 1px solid #eee; display: block; margin-bottom: 10px; }
        .btn-edit { display: flex; align-items: center; justify-content: center; width: 100%; height: 45px; margin-top: 10px; background: #f8f9fa; color: #333; border: 1px solid var(--border-color); border-radius: 8px; font-weight: bold; text-decoration: none; font-size: 14px; }
    </style>
</head>
<body>

<nav th:replace="~{index :: menu}"></nav>

<div class="container">
    <section class="user-welcome" style="margin-bottom: 30px;">
        <h2>안녕하세요, <span th:text="${member.name}">사용자</span>님!</h2>
        <p style="color: #666;">계좌 <span th:text="${accountCount}">0</span>개와 카드 <span th:text="${cardCount}">0</span>개를 관리 중입니다.</p>
    </section>

    <div class="dashboard-grid">
        <div class="main-column">
            <div class="card account-card">
                <div style="font-size: 14px; opacity: 0.8;">총 자산 합계</div>
                <div class="balance-amount" th:text="${#numbers.formatInteger(totalBalance, 0, 'COMMA')} + ' 원'">0 원</div>
                <div class="btn-group">
                    <a th:href="@{/account/list}" class="btn-action">계좌조회</a>
                    <a th:href="@{/account/transfer}" class="btn-action">이체하기</a>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    내 카드 지갑
                    <a th:href="@{/card/list}" style="font-size:13px; color:var(--primary-color); text-decoration:none;">전체관리 ></a>
                </div>
                <div class="card-wallet">
                    <th:block th:if="${cards != null && !#lists.isEmpty(cards)}">
                        <div th:each="card : ${cards}" class="card-visual" th:classappend="${card.cardType} + ' ' + ${card.status}">
                            <div style="font-size: 10px; opacity: 0.8;" th:text="${card.cardType}">CHECK</div>
                            <div class="card-num" th:text="${card.cardNumber}">0000-0000-0000-0000</div>
                            <div class="card-name" th:text="${member.name}">사용자명</div>
                        </div>
                    </th:block>
                    <div th:if="${cards == null || #lists.isEmpty(cards)}" style="width:100%; text-align:center; padding: 40px; color:#999; border: 1px dashed #ccc; border-radius:16px;">
                        보유하신 카드가 없습니다.
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">최근 계좌 거래 내역</div>
                <ul class="transaction-list">
                    <th:block th:if="${not #lists.isEmpty(accountHistories)}">
                        <li th:each="tx : ${accountHistories}" class="transaction-item">
                            <div class="tx-info">
                                <span class="desc"
                                      th:text="${tx.txType == 'TRANSFER_OUT' ? tx.targetAccountNumber + ' (송금)' : tx.description}">거래명</span>
                                <span class="time" th:text="${#temporals.format(tx.createdAt, 'MM.dd HH:mm')}">날짜</span>
                            </div>
                            <div class="tx-amount"
                                 th:style="${tx.txType == 'DEPOSIT' || tx.txType == 'TRANSFER_IN' ? 'color: var(--deposit-color);' : 'color: var(--accent-color);'}"
                                 th:text="${tx.txType == 'DEPOSIT' || tx.txType == 'TRANSFER_IN' ? '+ ' : '- '} + ${#numbers.formatInteger(tx.amount, 0, 'COMMA')} + '원'">
                                0원
                            </div>
                        </li>
                    </th:block>

                    <li th:if="${#lists.isEmpty(accountHistories)}" style="text-align: center; padding: 50px; color: #999;">
                        최근 거래 내역이 없습니다.
                    </li>
                </ul>
            </div>
        </div>

        <div class="side-column">
            <div class="card">
                <div class="card-title">보안 상태</div>
                <div style="text-align:center; padding:10px 0;">
                    <div style="font-size:24px; color:var(--safe-color); font-weight:bold;">Safe</div>
                    <p style="font-size:12px; color:#888; margin-top:5px;">현재 이상 없습니다.</p>
                </div>
                <a th:href="@{/mypage/confirm}" class="btn-edit">개인정보 수정</a>
            </div>

            <div class="card">
                <div class="card-title" style="font-size:15px;">금융 사기 신고</div>
                <a th:href="@{/support}" class="menu-item-side">피싱 신고</a>
                <a th:href="@{/card/list}" class="menu-item-side">분실 신고</a>
            </div>

            <div style="text-align:right;">
                <a th:href="@{/withdraw}" style="font-size:11px; color:#bbb; text-decoration: underline;">회원 탈퇴</a>
            </div>
        </div>
    </div>
</div>

</body>
</html>